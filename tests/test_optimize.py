import numpy as np
from itertools import product as prod
import math
import pytest

from adlib27.autodiff import AutoDiff as AD
from adlib27.elem_function import sin
from adlib27.optimize import optimize

#test optimize
def test_optimize():
    assert optimize([-1.0, 0.0, 1.0], ['x'], '3*x') == {'global maximum': {'input range': ([1.0], [1.0]), 'value range': (3.0, 3.0), 'inflection type': 'endpoint'}, 'global minimum': {'input range': ([-1.0], [-1.0]), 'value range': (-3.0, -3.0), 'inflection type': 'endpoint'}, 'all critical points': [{'variables': ['x'], 'input range': ([-1.0], [-1.0]), 'value range': (-3.0, -3.0), 'inflection type': 'endpoint'}, {'input range': ([1.0], [1.0]), 'value range': (3.0, 3.0), 'inflection type': 'endpoint'}]}
    assert optimize(list(np.linspace(-2, 2, 10)), ['a','b'], 'sin(a)*cos(b)') == {'global maximum': {'input range': ([1.5555555555555554, -0.22222222222222232], [1.9999999999999998, 0.2222222222222221]), 'value range': (0.9752968029145749, 0.8869378807444431), 'inflection type': 'critical point'}, 'global minimum': {'input range': ([-2.0, -0.22222222222222232], [-1.5555555555555556, 0.2222222222222221]), 'value range': (-0.8869378807444431, -0.9752968029145749), 'inflection type': 'critical point'}, 'all critical points': [{'variables': ['a', 'b'], 'input range': ([-2.0, -2.0], [-2.0, -2.0]), 'value range': (0.37840124765396416, 0.37840124765396416), 'inflection type': 'endpoint'}, {'input range': ([2.0, 2.0], [2.0, 2.0]), 'value range': (-0.37840124765396416, -0.37840124765396416), 'inflection type': 'endpoint'}, {'variables': ['a', 'b'], 'input range': ([-2.0, -0.22222222222222232], [-1.5555555555555556, 0.2222222222222221]), 'value range': (-0.8869378807444431, -0.9752968029145749), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-2.0, 2.0], [-1.5555555555555556, 2.4444444444444446]), 'value range': (0.37840124765396416, 0.41609850595854114), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-0.22222222222222232, 1.5555555555555554], [0.2222222222222221, 1.9999999999999998]), 'value range': (-0.003358901551262173, -0.09171782372139398), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-0.22222222222222232, 1.5555555555555554], [0.2222222222222221, 1.9999999999999998]), 'value range': (-0.003358901551262173, -0.09171782372139398), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-0.22222222222222232, -2.0], [0.2222222222222221, -1.5555555555555556]), 'value range': (0.09171782372139398, 0.003358901551262124), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-0.22222222222222232, 1.5555555555555554], [0.2222222222222221, 1.9999999999999998]), 'value range': (-0.003358901551262173, -0.09171782372139398), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([1.5555555555555554, -0.22222222222222232], [1.9999999999999998, 0.2222222222222221]), 'value range': (0.9752968029145749, 0.8869378807444431), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([1.5555555555555554, -0.22222222222222232], [1.9999999999999998, 0.2222222222222221]), 'value range': (0.9752968029145749, 0.8869378807444431), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([1.5555555555555554, 2.0], [1.9999999999999998, 2.4444444444444446]), 'value range': (-0.41609850595854114, -0.37840124765396416), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([2.0, -2.0], [2.4444444444444446, -1.5555555555555556]), 'value range': (-0.37840124765396416, -0.013857857569814412), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([-2.0, -0.22222222222222232], [-1.5555555555555556, 0.2222222222222221]), 'value range': (-0.8869378807444431, -0.9752968029145749), 'inflection type': 'critical point'}, {'variables': ['a', 'b'], 'input range': ([2.0, 1.5555555555555554], [2.4444444444444446, 1.9999999999999998]), 'value range': (0.013857857569814613, 0.37840124765396416), 'inflection type': 'critical point'}]}